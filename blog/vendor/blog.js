!function(t){"use strict";function i(t){return-1!==t.indexOf("//")}function e(t){return t.slice(0,t.lastIndexOf("/")+1)}function n(t){return-1!==t.toLowerCase().indexOf(".md")||-1!==t.toLowerCase().indexOf(".markdown")}function r(t,i){"/"==t[t.length-1]&&(t=t.substring(0,t.length-1));var e=t.split("/"),n=i.split("/");if("."==n[0])n.splice(0,1);else{if(".."!=n[0])return-1!=n[0].indexOf("http")||-1!=n[0].indexOf("https")?i:e.join("/")+"/"+n.join("/");e.splice(e.length-1,1),n.splice(0,1)}return r(e.join("/"),n.join("/"))}function a(o,f,d,g){var g=g||s,d=d||!1,m=g+f;t.get(m,function(a){marked.setOptions({highlight:function(t){return hljs.highlightAuto(t).value}});var f=t(o);if(f.html(marked(a)),f.find("[href]").each(function(){var a=t(this),o=a.attr("href");if(i(o)&&a.attr("target","_blank"),d&&n(o)&&a.attr("href","?"+o),!i(o)&&!d&&n(o)){var f=e(h);0==o.indexOf("../")?f=r(e(h),o):0==o.indexOf("__P__")?f=o.replace("__P__/",""):f+=o.replace("./",""),a.attr("href","?"+f)}}),!d){var c=t("#main-page").find("h1, h2, h3, h4, h5, h6").first().text();t("title").text(c),t.each(f.find("img"),function(i,e){var n=t(e).attr("alt")||"";t(e).addClass(-1!=n.indexOf("|left")?"img-left":-1!=n.indexOf("|right")?"img-right":"img-center")})}d&&(f.find("img").first().addClass("avatar"),t.each(f.find("li"),function(i,e){t(e).addClass("sidebar-item")})),t.each(f.find("img"),function(i,n){var a=t(n);if(0==a.attr("src").indexOf("__IMG__"))a.attr("src",a.attr("src").replace("__IMG__",l));else{var o=r(e(m),a.attr("src"));a.attr("src",o)}})}).fail(function(t){if(404===t.status){if("footer.md"===f)return void console.log("没有找到footer.md! 建议在p/目录下建立footer.md 文件来添加底部信息！");a("#main-page","404.md",!1,"/"+c+"/")}})}function o(i){t.getJSON("config.json",{},function(e){c=e.app_name||c,l=e.img_root||l;var n=e.description||"";d=e.markdown_root||d,s="/"+c+"/"+d+"/",t("meta[name=description]").first().attr("content",n),i()}).fail(function(t){alert("读取配置有误")})}function f(){o(function(){a("#sidebar-page","sidebar.md",!0),a("#main-page-footer","footer.md"),h=-1!==location.search.indexOf("&")?location.search.slice(1,location.search.indexOf("&")):location.search.slice(1,location.search.length),"/"===h.charAt(h.length-1)&&(h=h.slice(0,location.search.length-2)),""!==h&&n(h)?a("#main-page",h):a("#main-page","home.md")})}var c="",s="",l="img",d="p",h="";f()}(jQuery);